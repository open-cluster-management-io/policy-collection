apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  name: policy-limitclusteradmin
  annotations:
    policy.open-cluster-management.io/standards: NIST SP 800-53
    policy.open-cluster-management.io/categories: AC Access Control
    policy.open-cluster-management.io/controls: AC-3 Access Enforcement
    integrityshield.io/message: YXBpVmVyc2lvbjogcG9saWN5Lm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvL3YxCmtpbmQ6IFBvbGljeQptZXRhZGF0YToKICBuYW1lOiBwb2xpY3ktbGltaXRjbHVzdGVyYWRtaW4KICBhbm5vdGF0aW9uczoKICAgIHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby9zdGFuZGFyZHM6IE5JU1QgU1AgODAwLTUzCiAgICBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vY2F0ZWdvcmllczogQUMgQWNjZXNzIENvbnRyb2wKICAgIHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby9jb250cm9sczogQUMtMyBBY2Nlc3MgRW5mb3JjZW1lbnQKc3BlYzoKICByZW1lZGlhdGlvbkFjdGlvbjogaW5mb3JtCiAgZGlzYWJsZWQ6IGZhbHNlCiAgcG9saWN5LXRlbXBsYXRlczoKICAgIC0gb2JqZWN0RGVmaW5pdGlvbjoKICAgICAgICBhcGlWZXJzaW9uOiBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vdjEKICAgICAgICBraW5kOiBJYW1Qb2xpY3kgIyBsaW1pdCBjbHVzdGVyYWRtaW5yb2xlIGFuZCByZXBvcnQgdmlvbGF0aW9uCiAgICAgICAgbWV0YWRhdGE6CiAgICAgICAgICBuYW1lOiBwb2xpY3ktbGltaXRjbHVzdGVyYWRtaW4tZXhhbXBsZQogICAgICAgIHNwZWM6CiAgICAgICAgICBzZXZlcml0eTogbWVkaXVtCiAgICAgICAgICBuYW1lc3BhY2VTZWxlY3RvcjoKICAgICAgICAgICAgaW5jbHVkZTogWyIqIl0KICAgICAgICAgICAgZXhjbHVkZTogWyJrdWJlLSoiLCAib3BlbnNoaWZ0LSoiXQogICAgICAgICAgcmVtZWRpYXRpb25BY3Rpb246IGluZm9ybSAjIHRoZSBwb2xpY3ktdGVtcGxhdGUgc3BlYy5yZW1lZGlhdGlvbkFjdGlvbiBpcyBvdmVycmlkZGVuIGJ5IHRoZSBwcmVjZWRpbmcgcGFyYW1ldGVyIHZhbHVlIGZvciBzcGVjLnJlbWVkaWF0aW9uQWN0aW9uLgogICAgICAgICAgbWF4Q2x1c3RlclJvbGVCaW5kaW5nVXNlcnM6IDUKLS0tCmFwaVZlcnNpb246IHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby92MQpraW5kOiBQbGFjZW1lbnRCaW5kaW5nCm1ldGFkYXRhOgogIG5hbWU6IGJpbmRpbmctcG9saWN5LWxpbWl0Y2x1c3RlcmFkbWluCiAgYW5ub3RhdGlvbnM6IHt9CnBsYWNlbWVudFJlZjoKICBuYW1lOiBwbGFjZW1lbnQtcG9saWN5LWxpbWl0Y2x1c3RlcmFkbWluCiAga2luZDogUGxhY2VtZW50UnVsZQogIGFwaUdyb3VwOiBhcHBzLm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvCnN1YmplY3RzOgogIC0gbmFtZTogcG9saWN5LWxpbWl0Y2x1c3RlcmFkbWluCiAgICBraW5kOiBQb2xpY3kKICAgIGFwaUdyb3VwOiBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8KLS0tCmFwaVZlcnNpb246IGFwcHMub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vdjEKa2luZDogUGxhY2VtZW50UnVsZQptZXRhZGF0YToKICBuYW1lOiBwbGFjZW1lbnQtcG9saWN5LWxpbWl0Y2x1c3RlcmFkbWluCiAgYW5ub3RhdGlvbnM6IHt9CnNwZWM6CiAgY2x1c3RlckNvbmRpdGlvbnM6CiAgICAtIHN0YXR1czogIlRydWUiCiAgICAgIHR5cGU6IE1hbmFnZWRDbHVzdGVyQ29uZGl0aW9uQXZhaWxhYmxlCiAgY2x1c3RlclNlbGVjdG9yOgogICAgbWF0Y2hFeHByZXNzaW9uczoKICAgICAgLSB7a2V5OiBlbnZpcm9ubWVudCwgb3BlcmF0b3I6IEluLCB2YWx1ZXM6IFsiZGV2Il19Cg==
    integrityshield.io/signature: LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KCmlRSEdCQUFCQ0FBd0ZpRUVJbnBMR1hSY1QwV2tWTzgyVSt5TUt1c3JLdUlGQW1BSVhHb1NISE5vYVdWc1pFQnkKWldSb1lYUXVZMjl0QUFvSkVGUHNqQ3JyS3lyaTJNd01BSTlBSGpncWRvRGYrKzk1bmVVVXVrdG9Xa1BTN2ttMgpjN0t4M0Y1anU4WDBJdDRLK2pJeGhMQ01oZ3J6Yk1tZGV1alJIc081c01qZ2pUNmVXK1Q0NjczTGVjc2hYcGk0Cmh1MEJHRDc5RkRNTWU5R3YxY0psaVE3MDh6d1ByQU1tTThyYm9Nb2IyVmM4S2h2emZxQWwvcVVodHNrM2w2cWEKaklSZkRVZHNQV1ZkTmZXMDFIL2NzK0kwVGVuN2R5ZlYrQ0Z3S0l3QytBR3AyeXNlT2ZxSWNaZlZMbkY0SHVxVgo4ek1KOFdxS3g1OUxnNlpWMVk4RnJDZ0dlRWVXVmhDTjNVWitTY3psZiswTitMU3BObnVZVlB6VzB2Rm83STZyCmtEbTRrZDlwY0hZdDcxWTZBZGtqbVg4NHNZZEE3QytKSFdzYmN5V1JqS3VMK20xQ21aWUN2dTgrbUpaNTVTcEwKTXRMZTVZUEtaTDhPZEhUV1cxR1hKUjRqclpvem9lWGdJYlV1U01ncG5HK1BsUWFpSGlNRXNCK2R5M0ZVVUcvcQpSSThWTlZZTlBUdzM0YXBxdktKdnFsVU1ya0NvZ081c29FZDlwbVNxVm1FbGN1OXg3KzhOWmxKVHYyTXEvZ0tMCnY3NmFud3pHN0lGU2FTOWpGTURKV1o1eFBqOUYreDBlTUE9PQo9UmhrQwotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K
spec:
  remediationAction: inform
  disabled: false
  policy-templates:
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: IamPolicy # limit clusteradminrole and report violation
        metadata:
          name: policy-limitclusteradmin-example
        spec:
          severity: medium
          namespaceSelector:
            include: ["*"]
            exclude: ["kube-*", "openshift-*"]
          remediationAction: inform # the policy-template spec.remediationAction is overridden by the preceding parameter value for spec.remediationAction.
          maxClusterRoleBindingUsers: 5
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: binding-policy-limitclusteradmin
  annotations: {integrityshield.io/message: YXBpVmVyc2lvbjogcG9saWN5Lm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvL3YxCmtpbmQ6IFBvbGljeQptZXRhZGF0YToKICBuYW1lOiBwb2xpY3ktbGltaXRjbHVzdGVyYWRtaW4KICBhbm5vdGF0aW9uczoKICAgIHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby9zdGFuZGFyZHM6IE5JU1QgU1AgODAwLTUzCiAgICBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vY2F0ZWdvcmllczogQUMgQWNjZXNzIENvbnRyb2wKICAgIHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby9jb250cm9sczogQUMtMyBBY2Nlc3MgRW5mb3JjZW1lbnQKc3BlYzoKICByZW1lZGlhdGlvbkFjdGlvbjogaW5mb3JtCiAgZGlzYWJsZWQ6IGZhbHNlCiAgcG9saWN5LXRlbXBsYXRlczoKICAgIC0gb2JqZWN0RGVmaW5pdGlvbjoKICAgICAgICBhcGlWZXJzaW9uOiBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vdjEKICAgICAgICBraW5kOiBJYW1Qb2xpY3kgIyBsaW1pdCBjbHVzdGVyYWRtaW5yb2xlIGFuZCByZXBvcnQgdmlvbGF0aW9uCiAgICAgICAgbWV0YWRhdGE6CiAgICAgICAgICBuYW1lOiBwb2xpY3ktbGltaXRjbHVzdGVyYWRtaW4tZXhhbXBsZQogICAgICAgIHNwZWM6CiAgICAgICAgICBzZXZlcml0eTogbWVkaXVtCiAgICAgICAgICBuYW1lc3BhY2VTZWxlY3RvcjoKICAgICAgICAgICAgaW5jbHVkZTogWyIqIl0KICAgICAgICAgICAgZXhjbHVkZTogWyJrdWJlLSoiLCAib3BlbnNoaWZ0LSoiXQogICAgICAgICAgcmVtZWRpYXRpb25BY3Rpb246IGluZm9ybSAjIHRoZSBwb2xpY3ktdGVtcGxhdGUgc3BlYy5yZW1lZGlhdGlvbkFjdGlvbiBpcyBvdmVycmlkZGVuIGJ5IHRoZSBwcmVjZWRpbmcgcGFyYW1ldGVyIHZhbHVlIGZvciBzcGVjLnJlbWVkaWF0aW9uQWN0aW9uLgogICAgICAgICAgbWF4Q2x1c3RlclJvbGVCaW5kaW5nVXNlcnM6IDUKLS0tCmFwaVZlcnNpb246IHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby92MQpraW5kOiBQbGFjZW1lbnRCaW5kaW5nCm1ldGFkYXRhOgogIG5hbWU6IGJpbmRpbmctcG9saWN5LWxpbWl0Y2x1c3RlcmFkbWluCiAgYW5ub3RhdGlvbnM6IHt9CnBsYWNlbWVudFJlZjoKICBuYW1lOiBwbGFjZW1lbnQtcG9saWN5LWxpbWl0Y2x1c3RlcmFkbWluCiAga2luZDogUGxhY2VtZW50UnVsZQogIGFwaUdyb3VwOiBhcHBzLm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvCnN1YmplY3RzOgogIC0gbmFtZTogcG9saWN5LWxpbWl0Y2x1c3RlcmFkbWluCiAgICBraW5kOiBQb2xpY3kKICAgIGFwaUdyb3VwOiBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8KLS0tCmFwaVZlcnNpb246IGFwcHMub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vdjEKa2luZDogUGxhY2VtZW50UnVsZQptZXRhZGF0YToKICBuYW1lOiBwbGFjZW1lbnQtcG9saWN5LWxpbWl0Y2x1c3RlcmFkbWluCiAgYW5ub3RhdGlvbnM6IHt9CnNwZWM6CiAgY2x1c3RlckNvbmRpdGlvbnM6CiAgICAtIHN0YXR1czogIlRydWUiCiAgICAgIHR5cGU6IE1hbmFnZWRDbHVzdGVyQ29uZGl0aW9uQXZhaWxhYmxlCiAgY2x1c3RlclNlbGVjdG9yOgogICAgbWF0Y2hFeHByZXNzaW9uczoKICAgICAgLSB7a2V5OiBlbnZpcm9ubWVudCwgb3BlcmF0b3I6IEluLCB2YWx1ZXM6IFsiZGV2Il19Cg==, integrityshield.io/signature: LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KCmlRSEdCQUFCQ0FBd0ZpRUVJbnBMR1hSY1QwV2tWTzgyVSt5TUt1c3JLdUlGQW1BSVhHb1NISE5vYVdWc1pFQnkKWldSb1lYUXVZMjl0QUFvSkVGUHNqQ3JyS3lyaTJNd01BSTlBSGpncWRvRGYrKzk1bmVVVXVrdG9Xa1BTN2ttMgpjN0t4M0Y1anU4WDBJdDRLK2pJeGhMQ01oZ3J6Yk1tZGV1alJIc081c01qZ2pUNmVXK1Q0NjczTGVjc2hYcGk0Cmh1MEJHRDc5RkRNTWU5R3YxY0psaVE3MDh6d1ByQU1tTThyYm9Nb2IyVmM4S2h2emZxQWwvcVVodHNrM2w2cWEKaklSZkRVZHNQV1ZkTmZXMDFIL2NzK0kwVGVuN2R5ZlYrQ0Z3S0l3QytBR3AyeXNlT2ZxSWNaZlZMbkY0SHVxVgo4ek1KOFdxS3g1OUxnNlpWMVk4RnJDZ0dlRWVXVmhDTjNVWitTY3psZiswTitMU3BObnVZVlB6VzB2Rm83STZyCmtEbTRrZDlwY0hZdDcxWTZBZGtqbVg4NHNZZEE3QytKSFdzYmN5V1JqS3VMK20xQ21aWUN2dTgrbUpaNTVTcEwKTXRMZTVZUEtaTDhPZEhUV1cxR1hKUjRqclpvem9lWGdJYlV1U01ncG5HK1BsUWFpSGlNRXNCK2R5M0ZVVUcvcQpSSThWTlZZTlBUdzM0YXBxdktKdnFsVU1ya0NvZ081c29FZDlwbVNxVm1FbGN1OXg3KzhOWmxKVHYyTXEvZ0tMCnY3NmFud3pHN0lGU2FTOWpGTURKV1o1eFBqOUYreDBlTUE9PQo9UmhrQwotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K}
placementRef:
  name: placement-policy-limitclusteradmin
  kind: PlacementRule
  apiGroup: apps.open-cluster-management.io
subjects:
  - name: policy-limitclusteradmin
    kind: Policy
    apiGroup: policy.open-cluster-management.io
---
apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  name: placement-policy-limitclusteradmin
  annotations: {integrityshield.io/message: YXBpVmVyc2lvbjogcG9saWN5Lm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvL3YxCmtpbmQ6IFBvbGljeQptZXRhZGF0YToKICBuYW1lOiBwb2xpY3ktbGltaXRjbHVzdGVyYWRtaW4KICBhbm5vdGF0aW9uczoKICAgIHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby9zdGFuZGFyZHM6IE5JU1QgU1AgODAwLTUzCiAgICBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vY2F0ZWdvcmllczogQUMgQWNjZXNzIENvbnRyb2wKICAgIHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby9jb250cm9sczogQUMtMyBBY2Nlc3MgRW5mb3JjZW1lbnQKc3BlYzoKICByZW1lZGlhdGlvbkFjdGlvbjogaW5mb3JtCiAgZGlzYWJsZWQ6IGZhbHNlCiAgcG9saWN5LXRlbXBsYXRlczoKICAgIC0gb2JqZWN0RGVmaW5pdGlvbjoKICAgICAgICBhcGlWZXJzaW9uOiBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vdjEKICAgICAgICBraW5kOiBJYW1Qb2xpY3kgIyBsaW1pdCBjbHVzdGVyYWRtaW5yb2xlIGFuZCByZXBvcnQgdmlvbGF0aW9uCiAgICAgICAgbWV0YWRhdGE6CiAgICAgICAgICBuYW1lOiBwb2xpY3ktbGltaXRjbHVzdGVyYWRtaW4tZXhhbXBsZQogICAgICAgIHNwZWM6CiAgICAgICAgICBzZXZlcml0eTogbWVkaXVtCiAgICAgICAgICBuYW1lc3BhY2VTZWxlY3RvcjoKICAgICAgICAgICAgaW5jbHVkZTogWyIqIl0KICAgICAgICAgICAgZXhjbHVkZTogWyJrdWJlLSoiLCAib3BlbnNoaWZ0LSoiXQogICAgICAgICAgcmVtZWRpYXRpb25BY3Rpb246IGluZm9ybSAjIHRoZSBwb2xpY3ktdGVtcGxhdGUgc3BlYy5yZW1lZGlhdGlvbkFjdGlvbiBpcyBvdmVycmlkZGVuIGJ5IHRoZSBwcmVjZWRpbmcgcGFyYW1ldGVyIHZhbHVlIGZvciBzcGVjLnJlbWVkaWF0aW9uQWN0aW9uLgogICAgICAgICAgbWF4Q2x1c3RlclJvbGVCaW5kaW5nVXNlcnM6IDUKLS0tCmFwaVZlcnNpb246IHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby92MQpraW5kOiBQbGFjZW1lbnRCaW5kaW5nCm1ldGFkYXRhOgogIG5hbWU6IGJpbmRpbmctcG9saWN5LWxpbWl0Y2x1c3RlcmFkbWluCiAgYW5ub3RhdGlvbnM6IHt9CnBsYWNlbWVudFJlZjoKICBuYW1lOiBwbGFjZW1lbnQtcG9saWN5LWxpbWl0Y2x1c3RlcmFkbWluCiAga2luZDogUGxhY2VtZW50UnVsZQogIGFwaUdyb3VwOiBhcHBzLm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvCnN1YmplY3RzOgogIC0gbmFtZTogcG9saWN5LWxpbWl0Y2x1c3RlcmFkbWluCiAgICBraW5kOiBQb2xpY3kKICAgIGFwaUdyb3VwOiBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8KLS0tCmFwaVZlcnNpb246IGFwcHMub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vdjEKa2luZDogUGxhY2VtZW50UnVsZQptZXRhZGF0YToKICBuYW1lOiBwbGFjZW1lbnQtcG9saWN5LWxpbWl0Y2x1c3RlcmFkbWluCiAgYW5ub3RhdGlvbnM6IHt9CnNwZWM6CiAgY2x1c3RlckNvbmRpdGlvbnM6CiAgICAtIHN0YXR1czogIlRydWUiCiAgICAgIHR5cGU6IE1hbmFnZWRDbHVzdGVyQ29uZGl0aW9uQXZhaWxhYmxlCiAgY2x1c3RlclNlbGVjdG9yOgogICAgbWF0Y2hFeHByZXNzaW9uczoKICAgICAgLSB7a2V5OiBlbnZpcm9ubWVudCwgb3BlcmF0b3I6IEluLCB2YWx1ZXM6IFsiZGV2Il19Cg==, integrityshield.io/signature: LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KCmlRSEdCQUFCQ0FBd0ZpRUVJbnBMR1hSY1QwV2tWTzgyVSt5TUt1c3JLdUlGQW1BSVhHb1NISE5vYVdWc1pFQnkKWldSb1lYUXVZMjl0QUFvSkVGUHNqQ3JyS3lyaTJNd01BSTlBSGpncWRvRGYrKzk1bmVVVXVrdG9Xa1BTN2ttMgpjN0t4M0Y1anU4WDBJdDRLK2pJeGhMQ01oZ3J6Yk1tZGV1alJIc081c01qZ2pUNmVXK1Q0NjczTGVjc2hYcGk0Cmh1MEJHRDc5RkRNTWU5R3YxY0psaVE3MDh6d1ByQU1tTThyYm9Nb2IyVmM4S2h2emZxQWwvcVVodHNrM2w2cWEKaklSZkRVZHNQV1ZkTmZXMDFIL2NzK0kwVGVuN2R5ZlYrQ0Z3S0l3QytBR3AyeXNlT2ZxSWNaZlZMbkY0SHVxVgo4ek1KOFdxS3g1OUxnNlpWMVk4RnJDZ0dlRWVXVmhDTjNVWitTY3psZiswTitMU3BObnVZVlB6VzB2Rm83STZyCmtEbTRrZDlwY0hZdDcxWTZBZGtqbVg4NHNZZEE3QytKSFdzYmN5V1JqS3VMK20xQ21aWUN2dTgrbUpaNTVTcEwKTXRMZTVZUEtaTDhPZEhUV1cxR1hKUjRqclpvem9lWGdJYlV1U01ncG5HK1BsUWFpSGlNRXNCK2R5M0ZVVUcvcQpSSThWTlZZTlBUdzM0YXBxdktKdnFsVU1ya0NvZ081c29FZDlwbVNxVm1FbGN1OXg3KzhOWmxKVHYyTXEvZ0tMCnY3NmFud3pHN0lGU2FTOWpGTURKV1o1eFBqOUYreDBlTUE9PQo9UmhrQwotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K}
spec:
  clusterConditions:
    - status: "True"
      type: ManagedClusterConditionAvailable
  clusterSelector:
    matchExpressions:
      - {key: environment, operator: In, values: ["dev"]}
