apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  name: policy-certificate
  annotations:
    policy.open-cluster-management.io/standards: NIST SP 800-53
    policy.open-cluster-management.io/categories: SC System and Communications Protection
    policy.open-cluster-management.io/controls: SC-8 Transmission Confidentiality and Integrity
    integrityshield.io/message: YXBpVmVyc2lvbjogcG9saWN5Lm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvL3YxCmtpbmQ6IFBvbGljeQptZXRhZGF0YToKICBuYW1lOiBwb2xpY3ktY2VydGlmaWNhdGUKICBhbm5vdGF0aW9uczoKICAgIHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby9zdGFuZGFyZHM6IE5JU1QgU1AgODAwLTUzCiAgICBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vY2F0ZWdvcmllczogU0MgU3lzdGVtIGFuZCBDb21tdW5pY2F0aW9ucyBQcm90ZWN0aW9uCiAgICBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vY29udHJvbHM6IFNDLTggVHJhbnNtaXNzaW9uIENvbmZpZGVudGlhbGl0eSBhbmQgSW50ZWdyaXR5CnNwZWM6CiAgcmVtZWRpYXRpb25BY3Rpb246IGluZm9ybQogIGRpc2FibGVkOiBmYWxzZQogIHBvbGljeS10ZW1wbGF0ZXM6CiAgICAtIG9iamVjdERlZmluaXRpb246CiAgICAgICAgYXBpVmVyc2lvbjogcG9saWN5Lm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvL3YxCiAgICAgICAga2luZDogQ2VydGlmaWNhdGVQb2xpY3kgIyBjZXJ0IG1hbmFnZW1lbnQgZXhwaXJhdGlvbgogICAgICAgIG1ldGFkYXRhOgogICAgICAgICAgbmFtZTogcG9saWN5LWNlcnRpZmljYXRlLWV4YW1wbGUKICAgICAgICBzcGVjOgogICAgICAgICAgbmFtZXNwYWNlU2VsZWN0b3I6CiAgICAgICAgICAgIGluY2x1ZGU6IFsiZGVmYXVsdCJdCiAgICAgICAgICAgIGV4Y2x1ZGU6IFsia3ViZS0qIl0KICAgICAgICAgIHJlbWVkaWF0aW9uQWN0aW9uOiBpbmZvcm0gIyB0aGUgcG9saWN5LXRlbXBsYXRlIHNwZWMucmVtZWRpYXRpb25BY3Rpb24gaXMgb3ZlcnJpZGRlbiBieSB0aGUgcHJlY2VkaW5nIHBhcmFtZXRlciB2YWx1ZSBmb3Igc3BlYy5yZW1lZGlhdGlvbkFjdGlvbi4KICAgICAgICAgIHNldmVyaXR5OiBsb3cKICAgICAgICAgIG1pbmltdW1EdXJhdGlvbjogMzAwaAotLS0KYXBpVmVyc2lvbjogcG9saWN5Lm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvL3YxCmtpbmQ6IFBsYWNlbWVudEJpbmRpbmcKbWV0YWRhdGE6CiAgbmFtZTogYmluZGluZy1wb2xpY3ktY2VydGlmaWNhdGUKICBhbm5vdGF0aW9uczoge30KcGxhY2VtZW50UmVmOgogIG5hbWU6IHBsYWNlbWVudC1wb2xpY3ktY2VydGlmaWNhdGUKICBraW5kOiBQbGFjZW1lbnRSdWxlCiAgYXBpR3JvdXA6IGFwcHMub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8Kc3ViamVjdHM6CiAgLSBuYW1lOiBwb2xpY3ktY2VydGlmaWNhdGUKICAgIGtpbmQ6IFBvbGljeQogICAgYXBpR3JvdXA6IHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pbwotLS0KYXBpVmVyc2lvbjogYXBwcy5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby92MQpraW5kOiBQbGFjZW1lbnRSdWxlCm1ldGFkYXRhOgogIG5hbWU6IHBsYWNlbWVudC1wb2xpY3ktY2VydGlmaWNhdGUKICBhbm5vdGF0aW9uczoge30Kc3BlYzoKICBjbHVzdGVyQ29uZGl0aW9uczoKICAgIC0gc3RhdHVzOiAiVHJ1ZSIKICAgICAgdHlwZTogTWFuYWdlZENsdXN0ZXJDb25kaXRpb25BdmFpbGFibGUKICBjbHVzdGVyU2VsZWN0b3I6CiAgICBtYXRjaEV4cHJlc3Npb25zOgogICAgICAtIHtrZXk6IGVudmlyb25tZW50LCBvcGVyYXRvcjogSW4sIHZhbHVlczogWyJkZXYiXX0K
    integrityshield.io/signature: LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KCmlRSEdCQUFCQ0FBd0ZpRUVJbnBMR1hSY1QwV2tWTzgyVSt5TUt1c3JLdUlGQW1BSVhHY1NISE5vYVdWc1pFQnkKWldSb1lYUXVZMjl0QUFvSkVGUHNqQ3JyS3lyaTlpY0wvaXl0R3YzaTlSZjVaN2kvdVUxL0tBd3NnY2dPVmsxTQpock5xa01kUzEwZnpidjB2N0VBMnNKTXFncEExcUtLRGhLSG96U1FDZHRzeTcrZVFVb2Y1bm5HVmx2YVhHSFJ2CjVsaE9Ta1NRcmpQUUt3elNHNDRGcVRISzlGWGFSZmVGUXpMeHRWUkdlcDlZMFBrYTV2R21rcTYwYXYzVmFUcmsKMXFlS2w4dVJkMFBSV1prcjBWK0lQazEyMVRWb21QbHVMWnNpV1RLM1RiQ1R5QjJDZ001VGtaZU1zQVcwamFFQQphMkd0RlVUMWNqTlBrZjhFN1pMWjRQSTg5b1c2c1pXaDd3VXFyOXJqMDB3WDN6M2FEeUwvU203WjdqVnpSNTNkCm1rM3kvR3NPb0E4aW1hclhhYWJ2SFJvU2tnOVdUc3d5ei84QTNOa0xoMStWam93Qko1a2xDTHdWNXhOZFNnWXkKU2taQ3RaS3dteGk5UXB6MUpDek5KcWRacVJpajV4Zk9kK0JuZVdJSklpakNubVRDTVFCZkthMnZ5M0JxT1B1OQpJV09vVlF4eG5LYU1lS1ZiY3M1L09XeEdyZjRaU29jRzhNYWVrSkQzbFpGd0NzNjhENHc2dWdXZCs5QWl1SVN1CkgxN3NLRWlJSVlaK3VkekRFVFNiUEp2ZnFjM3lFUi8va0E9PQo9UFBRSAotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K
spec:
  remediationAction: inform
  disabled: false
  policy-templates:
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: CertificatePolicy # cert management expiration
        metadata:
          name: policy-certificate-example
        spec:
          namespaceSelector:
            include: ["default"]
            exclude: ["kube-*"]
          remediationAction: inform # the policy-template spec.remediationAction is overridden by the preceding parameter value for spec.remediationAction.
          severity: low
          minimumDuration: 300h
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: binding-policy-certificate
  annotations: {integrityshield.io/message: YXBpVmVyc2lvbjogcG9saWN5Lm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvL3YxCmtpbmQ6IFBvbGljeQptZXRhZGF0YToKICBuYW1lOiBwb2xpY3ktY2VydGlmaWNhdGUKICBhbm5vdGF0aW9uczoKICAgIHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby9zdGFuZGFyZHM6IE5JU1QgU1AgODAwLTUzCiAgICBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vY2F0ZWdvcmllczogU0MgU3lzdGVtIGFuZCBDb21tdW5pY2F0aW9ucyBQcm90ZWN0aW9uCiAgICBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vY29udHJvbHM6IFNDLTggVHJhbnNtaXNzaW9uIENvbmZpZGVudGlhbGl0eSBhbmQgSW50ZWdyaXR5CnNwZWM6CiAgcmVtZWRpYXRpb25BY3Rpb246IGluZm9ybQogIGRpc2FibGVkOiBmYWxzZQogIHBvbGljeS10ZW1wbGF0ZXM6CiAgICAtIG9iamVjdERlZmluaXRpb246CiAgICAgICAgYXBpVmVyc2lvbjogcG9saWN5Lm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvL3YxCiAgICAgICAga2luZDogQ2VydGlmaWNhdGVQb2xpY3kgIyBjZXJ0IG1hbmFnZW1lbnQgZXhwaXJhdGlvbgogICAgICAgIG1ldGFkYXRhOgogICAgICAgICAgbmFtZTogcG9saWN5LWNlcnRpZmljYXRlLWV4YW1wbGUKICAgICAgICBzcGVjOgogICAgICAgICAgbmFtZXNwYWNlU2VsZWN0b3I6CiAgICAgICAgICAgIGluY2x1ZGU6IFsiZGVmYXVsdCJdCiAgICAgICAgICAgIGV4Y2x1ZGU6IFsia3ViZS0qIl0KICAgICAgICAgIHJlbWVkaWF0aW9uQWN0aW9uOiBpbmZvcm0gIyB0aGUgcG9saWN5LXRlbXBsYXRlIHNwZWMucmVtZWRpYXRpb25BY3Rpb24gaXMgb3ZlcnJpZGRlbiBieSB0aGUgcHJlY2VkaW5nIHBhcmFtZXRlciB2YWx1ZSBmb3Igc3BlYy5yZW1lZGlhdGlvbkFjdGlvbi4KICAgICAgICAgIHNldmVyaXR5OiBsb3cKICAgICAgICAgIG1pbmltdW1EdXJhdGlvbjogMzAwaAotLS0KYXBpVmVyc2lvbjogcG9saWN5Lm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvL3YxCmtpbmQ6IFBsYWNlbWVudEJpbmRpbmcKbWV0YWRhdGE6CiAgbmFtZTogYmluZGluZy1wb2xpY3ktY2VydGlmaWNhdGUKICBhbm5vdGF0aW9uczoge30KcGxhY2VtZW50UmVmOgogIG5hbWU6IHBsYWNlbWVudC1wb2xpY3ktY2VydGlmaWNhdGUKICBraW5kOiBQbGFjZW1lbnRSdWxlCiAgYXBpR3JvdXA6IGFwcHMub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8Kc3ViamVjdHM6CiAgLSBuYW1lOiBwb2xpY3ktY2VydGlmaWNhdGUKICAgIGtpbmQ6IFBvbGljeQogICAgYXBpR3JvdXA6IHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pbwotLS0KYXBpVmVyc2lvbjogYXBwcy5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby92MQpraW5kOiBQbGFjZW1lbnRSdWxlCm1ldGFkYXRhOgogIG5hbWU6IHBsYWNlbWVudC1wb2xpY3ktY2VydGlmaWNhdGUKICBhbm5vdGF0aW9uczoge30Kc3BlYzoKICBjbHVzdGVyQ29uZGl0aW9uczoKICAgIC0gc3RhdHVzOiAiVHJ1ZSIKICAgICAgdHlwZTogTWFuYWdlZENsdXN0ZXJDb25kaXRpb25BdmFpbGFibGUKICBjbHVzdGVyU2VsZWN0b3I6CiAgICBtYXRjaEV4cHJlc3Npb25zOgogICAgICAtIHtrZXk6IGVudmlyb25tZW50LCBvcGVyYXRvcjogSW4sIHZhbHVlczogWyJkZXYiXX0K, integrityshield.io/signature: LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KCmlRSEdCQUFCQ0FBd0ZpRUVJbnBMR1hSY1QwV2tWTzgyVSt5TUt1c3JLdUlGQW1BSVhHY1NISE5vYVdWc1pFQnkKWldSb1lYUXVZMjl0QUFvSkVGUHNqQ3JyS3lyaTlpY0wvaXl0R3YzaTlSZjVaN2kvdVUxL0tBd3NnY2dPVmsxTQpock5xa01kUzEwZnpidjB2N0VBMnNKTXFncEExcUtLRGhLSG96U1FDZHRzeTcrZVFVb2Y1bm5HVmx2YVhHSFJ2CjVsaE9Ta1NRcmpQUUt3elNHNDRGcVRISzlGWGFSZmVGUXpMeHRWUkdlcDlZMFBrYTV2R21rcTYwYXYzVmFUcmsKMXFlS2w4dVJkMFBSV1prcjBWK0lQazEyMVRWb21QbHVMWnNpV1RLM1RiQ1R5QjJDZ001VGtaZU1zQVcwamFFQQphMkd0RlVUMWNqTlBrZjhFN1pMWjRQSTg5b1c2c1pXaDd3VXFyOXJqMDB3WDN6M2FEeUwvU203WjdqVnpSNTNkCm1rM3kvR3NPb0E4aW1hclhhYWJ2SFJvU2tnOVdUc3d5ei84QTNOa0xoMStWam93Qko1a2xDTHdWNXhOZFNnWXkKU2taQ3RaS3dteGk5UXB6MUpDek5KcWRacVJpajV4Zk9kK0JuZVdJSklpakNubVRDTVFCZkthMnZ5M0JxT1B1OQpJV09vVlF4eG5LYU1lS1ZiY3M1L09XeEdyZjRaU29jRzhNYWVrSkQzbFpGd0NzNjhENHc2dWdXZCs5QWl1SVN1CkgxN3NLRWlJSVlaK3VkekRFVFNiUEp2ZnFjM3lFUi8va0E9PQo9UFBRSAotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K}
placementRef:
  name: placement-policy-certificate
  kind: PlacementRule
  apiGroup: apps.open-cluster-management.io
subjects:
  - name: policy-certificate
    kind: Policy
    apiGroup: policy.open-cluster-management.io
---
apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  name: placement-policy-certificate
  annotations: {integrityshield.io/message: YXBpVmVyc2lvbjogcG9saWN5Lm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvL3YxCmtpbmQ6IFBvbGljeQptZXRhZGF0YToKICBuYW1lOiBwb2xpY3ktY2VydGlmaWNhdGUKICBhbm5vdGF0aW9uczoKICAgIHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby9zdGFuZGFyZHM6IE5JU1QgU1AgODAwLTUzCiAgICBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vY2F0ZWdvcmllczogU0MgU3lzdGVtIGFuZCBDb21tdW5pY2F0aW9ucyBQcm90ZWN0aW9uCiAgICBwb2xpY3kub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8vY29udHJvbHM6IFNDLTggVHJhbnNtaXNzaW9uIENvbmZpZGVudGlhbGl0eSBhbmQgSW50ZWdyaXR5CnNwZWM6CiAgcmVtZWRpYXRpb25BY3Rpb246IGluZm9ybQogIGRpc2FibGVkOiBmYWxzZQogIHBvbGljeS10ZW1wbGF0ZXM6CiAgICAtIG9iamVjdERlZmluaXRpb246CiAgICAgICAgYXBpVmVyc2lvbjogcG9saWN5Lm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvL3YxCiAgICAgICAga2luZDogQ2VydGlmaWNhdGVQb2xpY3kgIyBjZXJ0IG1hbmFnZW1lbnQgZXhwaXJhdGlvbgogICAgICAgIG1ldGFkYXRhOgogICAgICAgICAgbmFtZTogcG9saWN5LWNlcnRpZmljYXRlLWV4YW1wbGUKICAgICAgICBzcGVjOgogICAgICAgICAgbmFtZXNwYWNlU2VsZWN0b3I6CiAgICAgICAgICAgIGluY2x1ZGU6IFsiZGVmYXVsdCJdCiAgICAgICAgICAgIGV4Y2x1ZGU6IFsia3ViZS0qIl0KICAgICAgICAgIHJlbWVkaWF0aW9uQWN0aW9uOiBpbmZvcm0gIyB0aGUgcG9saWN5LXRlbXBsYXRlIHNwZWMucmVtZWRpYXRpb25BY3Rpb24gaXMgb3ZlcnJpZGRlbiBieSB0aGUgcHJlY2VkaW5nIHBhcmFtZXRlciB2YWx1ZSBmb3Igc3BlYy5yZW1lZGlhdGlvbkFjdGlvbi4KICAgICAgICAgIHNldmVyaXR5OiBsb3cKICAgICAgICAgIG1pbmltdW1EdXJhdGlvbjogMzAwaAotLS0KYXBpVmVyc2lvbjogcG9saWN5Lm9wZW4tY2x1c3Rlci1tYW5hZ2VtZW50LmlvL3YxCmtpbmQ6IFBsYWNlbWVudEJpbmRpbmcKbWV0YWRhdGE6CiAgbmFtZTogYmluZGluZy1wb2xpY3ktY2VydGlmaWNhdGUKICBhbm5vdGF0aW9uczoge30KcGxhY2VtZW50UmVmOgogIG5hbWU6IHBsYWNlbWVudC1wb2xpY3ktY2VydGlmaWNhdGUKICBraW5kOiBQbGFjZW1lbnRSdWxlCiAgYXBpR3JvdXA6IGFwcHMub3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQuaW8Kc3ViamVjdHM6CiAgLSBuYW1lOiBwb2xpY3ktY2VydGlmaWNhdGUKICAgIGtpbmQ6IFBvbGljeQogICAgYXBpR3JvdXA6IHBvbGljeS5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pbwotLS0KYXBpVmVyc2lvbjogYXBwcy5vcGVuLWNsdXN0ZXItbWFuYWdlbWVudC5pby92MQpraW5kOiBQbGFjZW1lbnRSdWxlCm1ldGFkYXRhOgogIG5hbWU6IHBsYWNlbWVudC1wb2xpY3ktY2VydGlmaWNhdGUKICBhbm5vdGF0aW9uczoge30Kc3BlYzoKICBjbHVzdGVyQ29uZGl0aW9uczoKICAgIC0gc3RhdHVzOiAiVHJ1ZSIKICAgICAgdHlwZTogTWFuYWdlZENsdXN0ZXJDb25kaXRpb25BdmFpbGFibGUKICBjbHVzdGVyU2VsZWN0b3I6CiAgICBtYXRjaEV4cHJlc3Npb25zOgogICAgICAtIHtrZXk6IGVudmlyb25tZW50LCBvcGVyYXRvcjogSW4sIHZhbHVlczogWyJkZXYiXX0K, integrityshield.io/signature: LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KCmlRSEdCQUFCQ0FBd0ZpRUVJbnBMR1hSY1QwV2tWTzgyVSt5TUt1c3JLdUlGQW1BSVhHY1NISE5vYVdWc1pFQnkKWldSb1lYUXVZMjl0QUFvSkVGUHNqQ3JyS3lyaTlpY0wvaXl0R3YzaTlSZjVaN2kvdVUxL0tBd3NnY2dPVmsxTQpock5xa01kUzEwZnpidjB2N0VBMnNKTXFncEExcUtLRGhLSG96U1FDZHRzeTcrZVFVb2Y1bm5HVmx2YVhHSFJ2CjVsaE9Ta1NRcmpQUUt3elNHNDRGcVRISzlGWGFSZmVGUXpMeHRWUkdlcDlZMFBrYTV2R21rcTYwYXYzVmFUcmsKMXFlS2w4dVJkMFBSV1prcjBWK0lQazEyMVRWb21QbHVMWnNpV1RLM1RiQ1R5QjJDZ001VGtaZU1zQVcwamFFQQphMkd0RlVUMWNqTlBrZjhFN1pMWjRQSTg5b1c2c1pXaDd3VXFyOXJqMDB3WDN6M2FEeUwvU203WjdqVnpSNTNkCm1rM3kvR3NPb0E4aW1hclhhYWJ2SFJvU2tnOVdUc3d5ei84QTNOa0xoMStWam93Qko1a2xDTHdWNXhOZFNnWXkKU2taQ3RaS3dteGk5UXB6MUpDek5KcWRacVJpajV4Zk9kK0JuZVdJSklpakNubVRDTVFCZkthMnZ5M0JxT1B1OQpJV09vVlF4eG5LYU1lS1ZiY3M1L09XeEdyZjRaU29jRzhNYWVrSkQzbFpGd0NzNjhENHc2dWdXZCs5QWl1SVN1CkgxN3NLRWlJSVlaK3VkekRFVFNiUEp2ZnFjM3lFUi8va0E9PQo9UFBRSAotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K}
spec:
  clusterConditions:
    - status: "True"
      type: ManagedClusterConditionAvailable
  clusterSelector:
    matchExpressions:
      - {key: environment, operator: In, values: ["dev"]}
